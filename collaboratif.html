<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Réseau Collaboratif | AFRICA.TECH21</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Exo 2', 'Segoe UI', sans-serif;
        }

        :root {
            --neon-blue: #00f0ff;
            --neon-purple: #7b2cbf;
            --neon-pink: #ff00ff;
            --neon-green: #00ff88;
            --dark-space: #0a0a12;
            --deep-space: #050510;
            --panel-dark: rgba(16, 16, 32, 0.95);
            --panel-glow: 0 0 20px rgba(0, 240, 255, 0.3), 0 0 40px rgba(123, 44, 191, 0.2);
            --text-primary: #ffffff;
            --text-secondary: #a0a8c0;
            --accent-glow: 0 0 15px var(--neon-blue);
            --glass: rgba(255, 255, 255, 0.08);
            --glass-border: rgba(255, 255, 255, 0.1);
            --online: #00ff88;
            --away: #ffaa00;
            --offline: #ff4757;
        }

        body {
            background: linear-gradient(135deg, var(--deep-space) 0%, var(--dark-space) 50%, #0f0f1f 100%);
            color: var(--text-primary);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        /* Effets de fond */
        .hologram-grid {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(90deg, rgba(0, 240, 255, 0.03) 1px, transparent 1px),
                linear-gradient(180deg, rgba(0, 240, 255, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: gridScan 20s linear infinite;
            pointer-events: none;
            z-index: -2;
        }

        .ambient-light {
            position: fixed;
            width: 500px;
            height: 500px;
            border-radius: 50%;
            filter: blur(100px);
            opacity: 0.1;
            z-index: -1;
        }

        .light-1 {
            background: var(--neon-blue);
            top: -200px;
            right: -100px;
            animation: floatLight 8s ease-in-out infinite;
        }

        .light-2 {
            background: var(--neon-purple);
            bottom: -150px;
            left: -100px;
            animation: floatLight 10s ease-in-out infinite reverse;
        }

        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .particle {
            position: absolute;
            width: 3px;
            height: 3px;
            background: var(--neon-blue);
            border-radius: 50%;
            animation: float 15s infinite linear;
            box-shadow: 0 0 10px var(--neon-blue);
        }

        @keyframes gridScan {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }

        @keyframes floatLight {
            0%, 100% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(50px, -30px) scale(1.1); }
        }

        @keyframes float {
            0% { transform: translateY(100vh) translateX(0) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-100px) translateX(100px) rotate(360deg); opacity: 0; }
        }

        /* Header */
        .neuro-header {
            background: rgba(20, 20, 35, 0.8);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(0, 240, 255, 0.2);
            padding: 1.5rem 3rem;
            position: relative;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .neuro-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--neon-blue), transparent);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1600px;
            margin: 0 auto;
        }

        .logo-container h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.2rem;
            background: linear-gradient(45deg, var(--neon-blue), var(--neon-pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: var(--accent-glow);
            letter-spacing: 2px;
            font-weight: 900;
        }

        .logo-container .subtitle {
            font-size: 0.9rem;
            color: var(--text-secondary);
            letter-spacing: 3px;
            text-transform: uppercase;
            margin-top: 0.5rem;
        }

        .user-panel {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .user-badge {
            background: rgba(0, 240, 255, 0.1);
            border: 1px solid rgba(0, 240, 255, 0.3);
            border-radius: 15px;
            padding: 0.8rem 1.5rem;
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-status {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--online);
            box-shadow: 0 0 10px var(--online);
        }

        .user-email {
            color: var(--neon-blue);
            font-weight: 600;
            font-size: 0.95rem;
        }

        .nav-buttons {
            display: flex;
            gap: 1rem;
        }

        .nav-btn {
            background: transparent;
            border: 2px solid;
            border-image: linear-gradient(45deg, var(--neon-blue), var(--neon-green)) 1;
            color: var(--neon-blue);
            padding: 0.7rem 1.2rem;
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Orbitron', sans-serif;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .nav-btn:hover {
            background: rgba(0, 240, 255, 0.1);
            box-shadow: 0 0 15px rgba(0, 240, 255, 0.3);
            transform: translateY(-2px);
        }

        .logout-btn {
            background: linear-gradient(135deg, var(--neon-purple), var(--neon-blue));
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(123, 44, 191, 0.4);
        }

        .logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(123, 44, 191, 0.6);
        }

        /* Container Principal */
        .collab-container {
            display: flex;
            min-height: calc(100vh - 120px);
            padding: 2rem;
            max-width: 1800px;
            margin: 0 auto;
            gap: 2rem;
        }

        /* Panneau Gauche - Salons */
        .channels-panel {
            width: 280px;
            background: var(--glass);
            backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            box-shadow: var(--panel-glow);
        }

        .panel-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            color: var(--neon-blue);
            margin-bottom: 2rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .channels-list {
            flex-grow: 1;
            overflow-y: auto;
        }

        .channel-item {
            padding: 1.2rem 1.5rem;
            margin-bottom: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid transparent;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .channel-item:hover {
            background: rgba(0, 240, 255, 0.1);
            border-color: var(--neon-blue);
        }

        .channel-item.active {
            background: rgba(0, 240, 255, 0.15);
            border-color: var(--neon-blue);
            box-shadow: 0 0 20px rgba(0, 240, 255, 0.2);
        }

        .channel-name {
            color: var(--text-primary);
            font-weight: 600;
            margin-bottom: 0.3rem;
        }

        .channel-desc {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .unread-badge {
            position: absolute;
            top: 50%;
            right: 1rem;
            transform: translateY(-50%);
            background: var(--neon-pink);
            color: white;
            font-size: 0.8rem;
            padding: 0.2rem 0.6rem;
            border-radius: 10px;
            font-weight: bold;
        }

        /* Panneau Central - Chat */
        .chat-panel {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            background: var(--glass);
            backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: var(--panel-glow);
        }

        .chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--glass-border);
        }

        .current-channel {
            font-family: 'Orbitron', sans-serif;
            font-size: 2rem;
            background: linear-gradient(45deg, var(--neon-blue), var(--neon-green));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .online-count {
            color: var(--neon-green);
            font-size: 1.1rem;
        }

        .messages-container {
            flex-grow: 1;
            overflow-y: auto;
            margin-bottom: 2rem;
            padding: 1rem;
            background: rgba(10, 10, 20, 0.3);
            border-radius: 15px;
            border: 1px solid var(--glass-border);
        }

        .message {
            margin-bottom: 1.5rem;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 1px solid transparent;
            transition: all 0.3s ease;
            position: relative;
        }

        .message:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(0, 240, 255, 0.2);
        }

        .message.own-message {
            background: rgba(0, 240, 255, 0.08);
            border-left: 4px solid var(--neon-blue);
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .message-user {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--neon-blue);
            font-weight: 700;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--neon-purple), var(--neon-blue));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .message-time {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .message-content {
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .message-actions {
            display: flex;
            gap: 1rem;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .message:hover .message-actions {
            opacity: 1;
        }

        .action-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.9rem;
            transition: color 0.3s ease;
        }

        .action-btn:hover {
            color: var(--neon-blue);
        }

        .chat-input-container {
            display: flex;
            gap: 1rem;
            align-items: flex-end;
        }

        .file-upload-btn {
            background: rgba(0, 240, 255, 0.1);
            border: 2px solid var(--neon-blue);
            color: var(--neon-blue);
            width: 60px;
            height: 60px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-upload-btn:hover {
            background: rgba(0, 240, 255, 0.2);
            box-shadow: 0 0 15px rgba(0, 240, 255, 0.3);
        }

        .message-input-wrapper {
            flex-grow: 1;
            position: relative;
        }

        .message-input {
            width: 100%;
            min-height: 60px;
            max-height: 150px;
            padding: 1rem 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            color: var(--text-primary);
            font-size: 1.1rem;
            resize: none;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .message-input:focus {
            outline: none;
            border-color: var(--neon-blue);
            box-shadow: 0 0 20px rgba(0, 240, 255, 0.3);
        }

        .send-btn {
            background: linear-gradient(135deg, var(--neon-purple), var(--neon-blue));
            color: white;
            border: none;
            width: 60px;
            height: 60px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 1.5rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(123, 44, 191, 0.4);
        }

        .send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(123, 44, 191, 0.6);
        }

        /* Panneau Droit - Membres & Tâches */
        .right-panel {
            width: 320px;
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .members-panel {
            background: var(--glass);
            backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: var(--panel-glow);
        }

        .members-list {
            margin-top: 1.5rem;
            max-height: 300px;
            overflow-y: auto;
        }

        .member-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            margin-bottom: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .member-item:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .member-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--neon-purple), var(--neon-blue));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .member-info {
            flex-grow: 1;
        }

        .member-name {
            color: var(--text-primary);
            font-weight: 600;
            margin-bottom: 0.2rem;
        }

        .member-role {
            color: var(--neon-green);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .member-status {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .status-online { background: var(--online); box-shadow: 0 0 10px var(--online); }
        .status-away { background: var(--away); box-shadow: 0 0 10px var(--away); }
        .status-offline { background: var(--offline); }

        .tasks-panel {
            background: var(--glass);
            backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 2rem;
            flex-grow: 1;
            box-shadow: var(--panel-glow);
        }

        .tasks-list {
            margin-top: 1.5rem;
        }

        .task-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 1.2rem;
            margin-bottom: 1rem;
            cursor: move;
            transition: all 0.3s ease;
        }

        .task-item:hover {
            border-color: var(--neon-blue);
            transform: translateX(5px);
        }

        .task-title {
            color: var(--text-primary);
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .task-desc {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .task-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
        }

        .task-assignee {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .task-priority {
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        .priority-high { background: rgba(255, 71, 87, 0.2); color: #ff4757; }
        .priority-medium { background: rgba(255, 170, 0, 0.2); color: #ffaa00; }
        .priority-low { background: rgba(0, 240, 255, 0.2); color: var(--neon-blue); }

        /* Éditeur de code */
        .code-editor-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .editor-container {
            width: 90%;
            max-width: 1000px;
            background: var(--dark-space);
            border: 2px solid var(--neon-blue);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 0 50px rgba(0, 240, 255, 0.5);
        }

        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .editor-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 2rem;
            color: var(--neon-blue);
        }

        .editor-close {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 2rem;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .editor-close:hover {
            color: var(--neon-pink);
        }

        .editor-textarea {
            width: 100%;
            height: 400px;
            background: #1a1a2e;
            color: var(--text-primary);
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            resize: none;
            margin-bottom: 1rem;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, var(--neon-blue), var(--neon-purple));
            border-radius: 10px;
        }
/* ==================== INFOS PROJET ==================== */
.project-info-panel {
    background: rgba(0, 240, 255, 0.1);
    border: 1px solid var(--neon-blue);
    border-radius: 10px;
    padding: 1.2rem;
    margin-top: 1.5rem;
    font-size: 0.9rem;
    animation: slideIn 0.5s ease;
}

@keyframes slideIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}

.project-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.8rem;
}

.project-header h4 {
    color: var(--neon-blue);
    font-family: 'Orbitron', sans-serif;
    font-size: 1.2rem;
}

.project-status {
    background: var(--neon-green);
    color: black;
    padding: 0.3rem 0.8rem;
    border-radius: 15px;
    font-size: 0.8rem;
    font-weight: bold;
    text-transform: uppercase;
}

.project-progress {
    margin: 1rem 0;
}

.progress-bar {
    height: 10px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 5px;
    margin: 0.5rem 0;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--neon-blue), var(--neon-green));
    border-radius: 5px;
    transition: width 1s ease;
}

.project-meta {
    display: flex;
    justify-content: space-between;
    margin-top: 1rem;
    font-size: 0.85rem;
    color: var(--text-secondary);
}

.project-meta i {
    margin-right: 5px;
    color: var(--neon-blue);
}
/* ==================== FIN INFOS PROJET ==================== */
        /* Responsive */
        @media (max-width: 1200px) {
            .collab-container {
                flex-direction: column;
            }
            
            .channels-panel,
            .right-panel {
                width: 100%;
            }
            
            .right-panel {
                flex-direction: row;
            }
            
            .members-panel,
            .tasks-panel {
                width: 50%;
            }
        }

        @media (max-width: 768px) {
            .neuro-header {
                padding: 1rem 1.5rem;
            }

            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .user-panel {
                flex-direction: column;
                gap: 1rem;
            }

            .collab-container {
                padding: 1rem;
            }

            .right-panel {
                flex-direction: column;
            }
            
            .members-panel,
            .tasks-panel {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Effets de fond -->
    <div class="hologram-grid"></div>
    <div class="ambient-light light-1"></div>
    <div class="ambient-light light-2"></div>
    <div class="particles" id="particles"></div>

    <!-- Header -->
    <header class="neuro-header">
        <div class="header-content">
            <div class="logo-container">
                <h1>AFRICA.TECH21</h1>
                <div class="subtitle">RÉSEAU COLLABORATIF</div>
            </div>
            <div class="user-panel">
                <div class="user-badge">
                    <div class="user-status" id="userStatusIndicator"></div>
                    <div class="user-email" id="userEmail">CHARGEMENT...</div>
                </div>
                <div class="nav-buttons">
                    <a href="dashboard.html" class="nav-btn">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </a>
                    <a href="rsma.html" class="nav-btn">
                        <i class="fas fa-water"></i> RSMA
                    </a>
                    <a href="oxy.html" class="nav-btn">
                        <i class="fas fa-wind"></i> OXY
                    </a>
                    <a href="rga.html" class="nav-btn">
                        <i class="fas fa-robot"></i> RGA
                    </a>
                </div>
                <button class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> DÉCONNEXION
                </button>
            </div>
        </div>
    </header>

    <!-- Container Principal -->
    <main class="collab-container">
        <!-- Panneau Gauche - Salons -->
        <aside class="channels-panel">
            <h2 class="panel-title">
                <i class="fas fa-hashtag"></i> CANAUX
            </h2>
           <div class="channels-list" id="channelsList">
    <!-- Canal Général -->
    <div class="channel-item active" data-channel="general" data-type="general">
        <div class="channel-name"># Général</div>
        <div class="channel-desc">Discussion générale de l'équipe</div>
    </div>
    
    <!-- Canal Technique -->
    <div class="channel-item" data-channel="technique" data-type="support">
        <div class="channel-name"># Technique</div>
        <div class="channel-desc">Support technique et aide</div>
    </div>
    
    <!-- Canal RSMA -->
    <div class="channel-item" data-channel="rsma" data-type="project" data-project="rsma">
        <div class="channel-name">
            <i class="fas fa-water" style="margin-right: 8px;"></i> # RSMA-Projet
        </div>
        <div class="channel-desc">
            Robot sous-marin autonome<br>
            <small style="color: var(--neon-green); font-size: 0.8rem;">
                <i class="fas fa-circle"></i> Développement Actif
            </small>
        </div>
    </div>
    
    <!-- Canal OXY -->
    <div class="channel-item" data-channel="oxy" data-type="project" data-project="oxy">
        <div class="channel-name">
            <i class="fas fa-wind" style="margin-right: 8px;"></i> # OXY-Projet
        </div>
        <div class="channel-desc">
            Système de production d'oxygène<br>
            <small style="color: var(--neon-blue); font-size: 0.8rem;">
                <i class="fas fa-flask"></i> Recherche & Développement
            </small>
        </div>
    </div>
    
    <!-- Canal RGA -->
    <div class="channel-item" data-channel="rga" data-type="project" data-project="rga">
        <div class="channel-name">
            <i class="fas fa-robot" style="margin-right: 8px;"></i> # RGA-Projet
        </div>
        <div class="channel-desc">
            Robot guide autonome<br>
            <small style="color: var(--neon-pink); font-size: 0.8rem;">
                <i class="fas fa-cogs"></i> Prototypage
            </small>
        </div>
    </div>
</div>
                    <div class="channel-name"># Général</div>
                    <div class="channel-desc">Discussion générale de l'équipe</div>
                </div>
                <div class="channel-item" data-channel="technique">
                    <div class="channel-name"># Technique</div>
                    <div class="channel-desc">Support technique et aide</div>
                </div>
                <div class="channel-item" data-channel="rsma">
                    <div class="channel-name"># RSMA-Projet</div>
                    <div class="channel-desc">Robot sous-marin autonome</div>
                </div>
                <div class="channel-item" data-channel="oxy">
                    <div class="channel-name"># OXY-Projet</div>
                    <div class="channel-desc">Système de production d'oxygène</div>
                </div>
                <div class="channel-item" data-channel="rga">
                    <div class="channel-name"># RGA-Projet</div>
                    <div class="channel-desc">Robot guide autonome</div>
                </div>
                <div class="channel-item" data-channel="annonces">
                    <div class="channel-name"># Annonces</div>
                    <div class="channel-desc">Annonces importantes</div>
                </div>
            </div>
            
            <div style="margin-top: 2rem;">
                <button class="nav-btn" style="width: 100%;" onclick="openCodeEditor()">
                    <i class="fas fa-code"></i> Éditeur Collaboratif
                </button>
            </div>
        </aside>

        <!-- Panneau Central - Chat -->
        <section class="chat-panel">
            <div class="chat-header">
                <div>
                    <h2 class="current-channel" id="currentChannel"># Général</h2>
                    <div class="online-count">
                        <i class="fas fa-user"></i> 
                        <span id="onlineCount">0</span> membres en ligne
                    </div>
                </div>
                <div>
                    <button class="nav-btn" onclick="openFileUpload()">
                        <i class="fas fa-paperclip"></i> Partager un fichier
                    </button>
                </div>
            </div>

            <div class="messages-container" id="messagesContainer">
                <!-- Messages chargés dynamiquement -->
                <div class="message system-message">
                    <div class="message-header">
                        <span class="message-user">
                            <div class="user-avatar">AT</div>
                            Système AFRICA.TECH21
                        </span>
                        <span class="message-time" id="currentTime"></span>
                    </div>
                    <p class="message-content">
                        Bienvenue sur le réseau collaboratif en temps réel. 
                        Tous les messages sont sauvegardés dans le cloud et accessibles depuis n'importe quel appareil.
                    </p>
                </div>
            </div>

            <div class="chat-input-container">
                <label class="file-upload-btn">
                    <i class="fas fa-paperclip"></i>
                    <input type="file" id="fileUpload" style="display: none;" onchange="handleFileUpload(event)">
                </label>
                
                <div class="message-input-wrapper">
                    <textarea 
                        class="message-input" 
                        id="messageInput" 
                        placeholder="Envoyez un message dans #général..."
                        rows="1"
                        onkeydown="handleKeyPress(event)"
                    ></textarea>
                </div>
                
                <button class="send-btn" onclick="sendMessage()">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </section>

        <!-- Panneau Droit - Membres & Tâches -->
        <aside class="right-panel">
            <!-- Membres en ligne -->
            <section class="members-panel">
                <h2 class="panel-title">
                    <i class="fas fa-users"></i> MEMBRES
                </h2>
                <div class="members-list" id="membersList">
                    <!-- Membres chargés dynamiquement -->
                </div>
            </section>

            <!-- Tâches en cours -->
            <section class="tasks-panel">
                <h2 class="panel-title">
                    <i class="fas fa-tasks"></i> TÂCHES
                </h2>
                <div class="tasks-list" id="tasksList">
                    <!-- Tâches chargées dynamiquement -->
                    <div class="task-item" draggable="true">
                        <div class="task-title">Intégration Firebase</div>
                        <div class="task-desc">Configurer l'authentification et Firestore pour le chat</div>
                        <div class="task-footer">
                            <div class="task-assignee">
                                <i class="fas fa-user"></i>
                                <span>ALPHA</span>
                            </div>
                            <div class="task-priority priority-high">Haute</div>
                        </div>
                    </div>
                    
                    <div class="task-item" draggable="true">
                        <div class="task-title">Design des canaux</div>
                        <div class="task-desc">Finaliser l'interface des salons de discussion</div>
                        <div class="task-footer">
                            <div class="task-assignee">
                                <i class="fas fa-user"></i>
                                <span>BETA</span>
                            </div>
                            <div class="task-priority priority-medium">Moyenne</div>
                        </div>
                    </div>
                    
                    <div class="task-item" draggable="true">
                        <div class="task-title">Système de fichiers</div>
                        <div class="task-desc">Implémenter le partage de fichiers</div>
                        <div class="task-footer">
                            <div class="task-assignee">
                                <i class="fas fa-user"></i>
                                <span>GAMMA</span>
                            </div>
                            <div class="task-priority priority-low">Basse</div>
                        </div>
                    </div>
                </div>
            </section>
        </aside>
    </main>

    <!-- Éditeur de code modal -->
    <div class="code-editor-modal" id="codeEditorModal">
        <div class="editor-container">
            <div class="editor-header">
                <h3 class="editor-title">Éditeur de Code Collaboratif</h3>
                <button class="editor-close" onclick="closeCodeEditor()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <textarea class="editor-textarea" id="codeEditor" placeholder="Collaborez sur du code ici...">
// Exemple de code
function helloWorld() {
    console.log("Bienvenue sur AFRICA.TECH21!");
    return "Innovation africaine";
}</textarea>
            <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                <button class="nav-btn" onclick="saveCode()">
                    <i class="fas fa-save"></i> Sauvegarder
                </button>
                <button class="logout-btn" onclick="shareCode()">
                    <i class="fas fa-share"></i> Partager
                </button>
            </div>
        </div>
    </div>

    <!-- Configuration Firebase -->
    <script>
        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDummyKeyReplaceWithYours",
            authDomain: "africa-tech21-collab.firebaseapp.com",
            projectId: "africa-tech21-collab",
            storageBucket: "africa-tech21-collab.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abcdef123456"
        };

        // Initialiser Firebase
        let firebaseApp, db, auth, storage;
        let currentUser = null;
        let currentChannel = 'general';
        let unsubscribeMessages = null;
        let unsubscribeMembers = null;
        let onlineStatusRef = null;
        
        async function initializeFirebase() {
            try {
                firebaseApp = firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                auth = firebase.auth();
                storage = firebase.storage();
                
                console.log("Firebase initialisé avec succès");
                
                // Vérifier l'authentification
                auth.onAuthStateChanged((user) => {
                    if (user) {
                        currentUser = user;
                        setupUserPresence();
                        loadChannels();
                        loadMembers();
                        loadTasks();
                    } else {
                        // Rediriger vers la page de connexion
                        window.location.href = 'espace-membres.html';
                    }
                });
                
            } catch (error) {
                console.error("Erreur Firebase:", error);
                // Mode démo si Firebase échoue
                setupDemoMode();
            }
        }

        function setupDemoMode() {
            console.log("Mode démo activé");
            // Simuler un utilisateur
            currentUser = {
                email: localStorage.getItem('memberEmail') || 'demo@africa.tech21',
                displayName: 'Demo User'
            };
            
            // Charger les données de démonstration
            loadDemoData();
        }

        function setupUserPresence() {
            if (!currentUser || !db) return;
            
            const userStatusRef = db.collection('status').doc(currentUser.uid);
            const isOfflineForFirestore = {
                state: 'offline',
                lastChanged: firebase.firestore.FieldValue.serverTimestamp(),
            };

            const isOnlineForFirestore = {
                state: 'online',
                lastChanged: firebase.firestore.FieldValue.serverTimestamp(),
            };

            // Référence pour vérifier la connexion
            const connectedRef = db.collection('.info/connected');
            
            connectedRef.onSnapshot((snapshot) => {
                if (snapshot.data().connected) {
                    userStatusRef.set(isOnlineForFirestore);
                    document.getElementById('userStatusIndicator').style.background = 'var(--online)';
                    
                    // Définir le statut sur 'away' quand l'utilisateur quitte la page
                    window.addEventListener('beforeunload', () => {
                        userStatusRef.set(isOfflineForFirestore);
                    });
                }
            });
            
            onlineStatusRef = userStatusRef;
        }

        function loadChannels() {
            const channels = document.querySelectorAll('.channel-item');
            channels.forEach(channel => {
                channel.addEventListener('click', () => {
                    // Retirer la classe active de tous les canaux
                    channels.forEach(c => c.classList.remove('active'));
                    // Ajouter la classe active au canal cliqué
                    channel.classList.add('active');
                    
                    // Changer de canal
                    const newChannel = channel.getAttribute('data-channel');
                    switchChannel(newChannel);
                });
            });
        }

       function switchChannel(channelName, channelType = 'general', projectName = null) {
    if (currentChannel === channelName) return;
    
    currentChannel = channelName;
    document.getElementById('currentChannel').textContent = `# ${capitalizeFirstLetter(channelName)}`;
    document.getElementById('messageInput').placeholder = `Envoyez un message dans #${channelName}...`;
    
    // Se désabonner des anciens messages
    if (unsubscribeMessages) {
        unsubscribeMessages();
    }
    
    // Afficher les infos projet si c'est un canal projet
    if (channelType === 'project' && projectName) {
        displayProjectInfo(projectName);
    } else {
        hideProjectInfo();
    }
    
    // Charger les messages du nouveau canal
    loadChannelMessages(channelName);
}

function displayProjectInfo(projectName) {
    const projectData = {
        rsma: {
            title: "RSMA V1.0",
            description: "Robot Sous-marin Autonome pour l'exploration marine",
            status: "Développement Actif",
            progress: 65,
            members: ["ALPHA", "GAMMA", "DELTA"],
            nextDeadline: "15 Février 2024",
            version: "1.0.3"
        },
        oxy: {
            title: "PROJET OXY",
            description: "Système mécanique innovant de production d'oxygène",
            status: "Phase de R&D",
            progress: 40,
            members: ["BETA", "EPSILON"],
            nextDeadline: "28 Mars 2024",
            version: "0.8.1"
        },
        rga: {
            title: "ROBOT DE GUIDE (RGA)",
            description: "Robot intelligent autonome pour l'accueil et l'assistance",
            status: "Prototypage",
            progress: 30,
            members: ["ALPHA", "BETA", "GAMMA"],
            nextDeadline: "10 Avril 2024",
            version: "0.5.2"
        }
    };
    
    const data = projectData[projectName];
    if (!data) return;
    
    const projectInfoHTML = `
        <div class="project-info-panel">
            <div class="project-header">
                <h4><i class="fas fa-project-diagram"></i> ${data.title}</h4>
                <span class="project-status">${data.status}</span>
            </div>
            <p style="margin-bottom: 1rem; color: var(--text-secondary);">
                ${data.description}
            </p>
            <div class="project-progress">
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${data.progress}%"></div>
                </div>
                <div style="display: flex; justify-content: space-between; font-size: 0.85rem;">
                    <span>Progression: <strong>${data.progress}%</strong></span>
                    <span>Version: <strong>${data.version}</strong></span>
                </div>
            </div>
            <div class="project-meta">
                <div><i class="fas fa-users"></i> Équipe: ${data.members.join(', ')}</div>
                <div><i class="fas fa-calendar-alt"></i> Deadline: ${data.nextDeadline}</div>
            </div>
        </div>
    `;
    
    // Ajouter ou mettre à jour le panneau
    const chatHeader = document.querySelector('.chat-header');
    let existingPanel = document.getElementById('projectInfoPanel');
    
    if (existingPanel) {
        existingPanel.innerHTML = projectInfoHTML;
    } else {
        const panel = document.createElement('div');
        panel.id = 'projectInfoPanel';
        panel.innerHTML = projectInfoHTML;
        chatHeader.appendChild(panel);
    }
}

function hideProjectInfo() {
    const panel = document.getElementById('projectInfoPanel');
    if (panel) {
        panel.remove();
    }
}

        async function loadChannelMessages(channelName) {
            if (!db) {
                loadDemoMessages();
                return;
            }
            
            try {
                const messagesRef = db.collection('channels').doc(channelName).collection('messages')
                    .orderBy('timestamp', 'asc')
                    .limit(100);
                
                unsubscribeMessages = messagesRef.onSnapshot((snapshot) => {
                    const messagesContainer = document.getElementById('messagesContainer');
                    // Garder uniquement le message système
                    const systemMessage = messagesContainer.querySelector('.system-message');
                    messagesContainer.innerHTML = '';
                    if (systemMessage) {
                        messagesContainer.appendChild(systemMessage);
                    }
                    
                    snapshot.forEach(doc => {
                        const message = doc.data();
                        displayMessage(message);
                    });
                    
                    // Scroll vers le bas
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                });
                
            } catch (error) {
                console.error("Erreur chargement messages:", error);
                loadDemoMessages();
            }
        }

        function displayMessage(message) {
            const messagesContainer = document.getElementById('messagesContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            
            // Vérifier si c'est notre message
            if (message.userId === currentUser?.uid) {
                messageDiv.classList.add('own-message');
            }
            
            const time = message.timestamp?.toDate ? 
                formatTime(message.timestamp.toDate()) : 
                message.time || 'Maintenant';
            
            messageDiv.innerHTML = `
                <div class="message-header">
                    <span class="message-user">
                        <div class="user-avatar">${getInitials(message.userName)}</div>
                        ${message.userName}
                    </span>
                    <span class="message-time">${time}</span>
                </div>
                <p class="message-content">${escapeHtml(message.text)}</p>
                ${message.fileUrl ? `
                    <div class="message-file">
                        <a href="${message.fileUrl}" target="_blank" style="color: var(--neon-blue);">
                            <i class="fas fa-paperclip"></i> Fichier joint
                        </a>
                    </div>
                ` : ''}
                <div class="message-actions">
                    <button class="action-btn" onclick="reactToMessage('${message.id}', 'like')">
                        <i class="far fa-thumbs-up"></i>
                    </button>
                    <button class="action-btn" onclick="copyMessage('${message.text}')">
                        <i class="far fa-copy"></i>
                    </button>
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
        }

        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            
            if (!text && !currentFile) return;
            
            const message = {
                text: text,
                userName: currentUser?.displayName || currentUser?.email.split('@')[0] || 'Membre',
                userId: currentUser?.uid || 'demo-user',
                channel: currentChannel,
                timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                time: new Date().toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' })
            };
            
            // Ajouter l'URL du fichier si présent
            if (currentFile) {
                message.fileName = currentFile.name;
                message.fileUrl = await uploadFile(currentFile);
                currentFile = null;
                document.querySelector('.file-upload-btn i').className = 'fas fa-paperclip';
            }
            
            if (db) {
                try {
                    await db.collection('channels').doc(currentChannel).collection('messages').add(message);
                } catch (error) {
                    console.error("Erreur envoi message:", error);
                    // Sauvegarder localement en cas d'erreur
                    saveMessageLocally(message);
                }
            } else {
                saveMessageLocally(message);
                displayMessage(message);
            }
            
            input.value = '';
            input.style.height = 'auto';
        }

        async function uploadFile(file) {
            if (!storage) return null;
            
            try {
                const storageRef = storage.ref();
                const fileRef = storageRef.child(`collab/${currentChannel}/${Date.now()}_${file.name}`);
                await fileRef.put(file);
                const url = await fileRef.getDownloadURL();
                return url;
            } catch (error) {
                console.error("Erreur upload fichier:", error);
                return null;
            }
        }

        let currentFile = null;
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            currentFile = file;
            document.querySelector('.file-upload-btn i').className = 'fas fa-check';
            
            // Afficher un aperçu
            alert(`Fichier "${file.name}" prêt à être envoyé. Tapez votre message et cliquez sur envoyer.`);
        }

        function loadMembers() {
            if (!db) {
                loadDemoMembers();
                return;
            }
            
            const membersRef = db.collection('members').where('isActive', '==', true);
            
            unsubscribeMembers = membersRef.onSnapshot((snapshot) => {
                const membersList = document.getElementById('membersList');
                membersList.innerHTML = '';
                let onlineCount = 0;
                
                snapshot.forEach(doc => {
                    const member = doc.data();
                    displayMember(member);
                    if (member.status === 'online') onlineCount++;
                });
                
                document.getElementById('onlineCount').textContent = onlineCount;
            });
        }

        function displayMember(member) {
            const membersList = document.getElementById('membersList');
            const memberDiv = document.createElement('div');
            memberDiv.className = 'member-item';
            
            memberDiv.innerHTML = `
                <div class="member-avatar">${getInitials(member.name)}</div>
                <div class="member-info">
                    <div class="member-name">${member.name}</div>
                    <div class="member-role">${member.role || 'Membre'}</div>
                </div>
                <div class="member-status status-${member.status || 'offline'}"></div>
            `;
            
            membersList.appendChild(memberDiv);
        }

        function loadTasks() {
            // Pour l'instant, les tâches sont statiques
            // À intégrer avec Firestore plus tard
            setupTaskDragAndDrop();
        }

        function setupTaskDragAndDrop() {
            const tasks = document.querySelectorAll('.task-item');
            const tasksList = document.getElementById('tasksList');
            
            tasks.forEach(task => {
                task.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', task.querySelector('.task-title').textContent);
                    task.classList.add('dragging');
                });
                
                task.addEventListener('dragend', () => {
                    task.classList.remove('dragging');
                });
            });
            
            tasksList.addEventListener('dragover', (e) => {
                e.preventDefault();
                const draggingTask = document.querySelector('.dragging');
                const afterElement = getDragAfterElement(tasksList, e.clientY);
                
                if (afterElement == null) {
                    tasksList.appendChild(draggingTask);
                } else {
                    tasksList.insertBefore(draggingTask, afterElement);
                }
            });
        }

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.task-item:not(.dragging)')];
            
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        // Fonctions utilitaires
        function capitalizeFirstLetter(string) {
            return string.charAt(0).toUpperCase() + string.slice(1);
        }

        function formatTime(date) {
            return date.toLocaleTimeString('fr-FR', { 
                hour: '2-digit', 
                minute: '2-digit',
                day: 'numeric',
                month: 'short'
            });
        }

        function getInitials(name) {
            return name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
            
            // Auto-resize du textarea
            if (event.key === 'Enter' || event.key === 'Backspace') {
                setTimeout(() => {
                    const textarea = event.target;
                    textarea.style.height = 'auto';
                    textarea.style.height = Math.min(textarea.scrollHeight, 150) + 'px';
                }, 0);
            }
        }

        function openCodeEditor() {
            document.getElementById('codeEditorModal').style.display = 'flex';
        }

        function closeCodeEditor() {
            document.getElementById('codeEditorModal').style.display = 'none';
        }

        function saveCode() {
            const code = document.getElementById('codeEditor').value;
            localStorage.setItem('collab_code', code);
            alert('Code sauvegardé localement !');
        }

        function shareCode() {
            const code = document.getElementById('codeEditor').value;
            // À implémenter: partage via Firestore
            alert('Fonctionnalité de partage à venir !');
        }

        function logout() {
            if (onlineStatusRef) {
                onlineStatusRef.set({
                    state: 'offline',
                    lastChanged: firebase.firestore.FieldValue.serverTimestamp(),
                });
            }
            
            if (auth) {
                auth.signOut();
            }
            
            localStorage.removeItem('memberLoggedIn');
            localStorage.removeItem('memberEmail');
            window.location.href = 'index.html';
        }

        // Données de démonstration
        function loadDemoData() {
            loadDemoMembers();
            loadDemoMessages();
        }

        function loadDemoMembers() {
            const demoMembers = [
                { name: "ALPHA", role: "Lead Dev", status: "online" },
                { name: "BETA", role: "Designer", status: "online" },
                { name: "GAMMA", role: "Dev Ops", status: "away" },
                { name: "DELTA", role: "Admin", status: "offline" },
                { name: "EPSILON", role: "Data Scientist", status: "online" }
            ];
            
            demoMembers.forEach(member => displayMember(member));
            document.getElementById('onlineCount').textContent = 3;
        }

        function loadDemoMessages() {
            const demoMessages = [
                {
                    text: "Bienvenue sur le réseau collaboratif ! N'hésitez pas à partager vos idées.",
                    userName: "ALPHA",
                    time: "14:30"
                },
                {
                    text: "J'ai terminé le design du dashboard RSMA. Qui veut review ?",
                    userName: "BETA",
                    time: "14:45"
                },
                {
                    text: "Je m'occupe de la review ce soir. Tu peux envoyer le lien Figma ?",
                    userName: "GAMMA",
                    time: "15:00"
                }
            ];
            
            demoMessages.forEach(msg => displayMessage(msg));
        }

        function saveMessageLocally(message) {
            const messages = JSON.parse(localStorage.getItem('demo_messages') || '[]');
            messages.push(message);
            localStorage.setItem('demo_messages', JSON.stringify(messages.slice(-50))); // Garder les 50 derniers
        }

        function updateUnreadBadge(channelName) {
            // À implémenter: suivre les messages non lus
        }

        function updateCurrentTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = 
                now.toLocaleDateString('fr-FR', { 
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric'
                }) + ' - ' + 
                now.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', () => {
            // Vérifier la connexion
            if (localStorage.getItem('memberLoggedIn') !== 'true') {
                window.location.href = 'espace-membres.html';
                return;
            }
            
            // Afficher l'email de l'utilisateur
            const userEmail = localStorage.getItem('memberEmail') || 'UTILISATEUR';
            document.getElementById('userEmail').textContent = userEmail;
            
            // Initialiser Firebase
            initializeFirebase();
            
            // Mettre à jour l'heure
            updateCurrentTime();
            setInterval(updateCurrentTime, 60000);
            
            // Créer des particules
            createParticles();
        });

        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + 'vw';
                particle.style.animationDelay = Math.random() * 15 + 's';
                particle.style.animationDuration = (8 + Math.random() * 12) + 's';
                particle.style.background = Math.random() > 0.5 ? 'var(--neon-blue)' : 'var(--neon-purple)';
                particlesContainer.appendChild(particle);
            }
        }

        function openFileUpload() {
            document.getElementById('fileUpload').click();
        }
    </script>
</body>
</html>
